<!doctype html>
<html lang="bg">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CheckAI ‚Äî –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –§–∞–∫—Ç–∏</title>
  <link rel="stylesheet" href="factcheck.css" />
  <style>
    /* Loading bar */
    .loading-bar{
      display: none;
      height: 3px;
      width: 100%;
      background: linear-gradient(90deg, #2a7a8a, #1F7A8C);
      border-radius: 2px;
      overflow: hidden;
      margin-top: 1.5rem;
      margin-bottom: 1.5rem;
      box-shadow: 0 0 10px rgba(42,122,138,0.3);
    }
    .loading-bar.active{
      display: block;
      animation: progress-animation 1.5s ease-in-out infinite;
    }
    .loading-bar::after{
      content: '';
      display: block;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      animation: shimmer 2s infinite;
    }
    @keyframes progress-animation{
      0%{ width: 0%; }
      50%{ width: 100%; }
      100%{ width: 100%; }
    }
    @keyframes shimmer{
      0%{ transform: translateX(-100%); }
      100%{ transform: translateX(100%); }
    }

    /* Results card */
    .result-card{
      margin-top:16px;
      border-radius:10px;
      padding:12px 14px;
      box-shadow:0 10px 30px rgba(10,20,40,0.06);
      background:linear-gradient(180deg,#ffffff,#fbfdff);
      opacity:0; transform:translateY(8px) scale(.995);
      transition:opacity .28s ease,transform .28s cubic-bezier(.2,.9,.3,1);
    }
    .result-card.show{ opacity:1; transform:translateY(0) scale(1); }
    .verdict{ font-weight:700; margin-bottom:6px; }
    .verdict.true{ color: #127a3c; }
    .verdict.false{ color: #b52222; }
    .verdict.uncertain{ color: #a07b00; }
    .confidence{ font-size:13px; color:#334; opacity:.8; }
    .explain{ margin-top:8px; color:#243b4a; opacity:.9; line-height:1.35 }
    .controls-row{ display:flex; gap:8px; align-items:center; margin-top:10px }
    .btn:disabled{ opacity:.6; cursor:not-allowed }
    .sr-only{ position:absolute; left:-9999px; }
  </style>
</head>
<body>
  <header class="site-header">
    <a class="back" href="index.html" aria-label="–ù–∞–∑–∞–¥ –Ω–∞ –Ω–∞—á–∞–ª–æ">‚Üê –ù–∞–∑–∞–¥</a>
    <div class="logo">CheckAI</div>
  </header>

  <main class="page-wrap">
    <section class="center-col">
      <div class="card">
        <h1 class="page-title">–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –§–∞–∫—Ç–∏</h1>

        <label for="claim" class="sr-only">–ü–æ—Å—Ç–∞–≤–∏ —Ç–≤—ä—Ä–¥–µ–Ω–∏–µ —Ç—É–∫</label>
        <textarea id="claim" class="claim-input" placeholder="–ü–æ—Å—Ç–∞–≤–∏ —Ç–≤—ä—Ä–¥–µ–Ω–∏–µ —Ç—É–∫..."></textarea>

        <div class="actions">
          <button class="btn verify">–ü—Ä–æ–≤–µ—Ä–∫–∞</button>
        </div>

        <div class="loading-bar" id="loading-bar"></div>

        <div class="results" id="results">
          <p class="results-empty">–†–µ–∑—É–ª—Ç–∞—Ç–∏—Ç–µ —â–µ —Å–µ –ø–æ—è–≤—è—Ç —Ç—É–∫ —Å–ª–µ–¥ –ø—Ä–æ–≤–µ—Ä–∫–∞—Ç–∞.</p>
        </div>
      </div>
    </section>
  </main>



<script>
(function(){
  const claimEl = document.getElementById('claim');
  const verifyBtn = document.querySelector('.btn.verify');
  const resultsEl = document.getElementById('results');
  const loadingBar = document.getElementById('loading-bar');

  function speakText(text, preferredLang){
    if(!('speechSynthesis' in window)) return;
    window.speechSynthesis.cancel();
    const utter = new SpeechSynthesisUtterance(text);
    const voices = window.speechSynthesis.getVoices();
    const voice = voices.find(v => v.lang && v.lang.toLowerCase().startsWith((preferredLang||'bg').toLowerCase()));
    if(voice) utter.voice = voice;
    else utter.lang = preferredLang || 'bg-BG';
    window.speechSynthesis.speak(utter);
  }

  function setLoading(isLoading){
    verifyBtn.disabled = isLoading;
    if(isLoading){
      loadingBar.classList.add('active');
    } else {
      loadingBar.classList.remove('active');
    }
  }

  function renderResult({verdict, confidence, explanation, claim}){
    resultsEl.innerHTML = '';
    const card = document.createElement('div');
    card.className = 'result-card';

    const v = document.createElement('div');
    // –ö–∞—Ä—Ç–æ–≥—Ä–∞—Ñ–∏—Ä–∞–π –±—ä–ª–≥–∞—Ä—Å–∫–∏/—Å–º–µ—Å–µ–Ω–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏ –∫—ä–º –∫–ª–∞—Å–æ–≤–µ true/false/–Ω–µ—è—Å–Ω–æ
    const normClass = verdict.toLowerCase().includes('–≤—è—Ä') || verdict.toLowerCase().includes('true') ? 'true' : 
                      verdict.toLowerCase().includes('–Ω–µ–≤—è—Ä') || verdict.toLowerCase().includes('false') ? 'false' : 'uncertain';
    
    v.className = 'verdict ' + normClass;
    v.textContent = verdict;

    const c = document.createElement('div');
    c.className = 'confidence';
    c.textContent = `–£–≤–µ—Ä–µ–Ω–æ—Å—Ç: ${confidence}%`;

    const e = document.createElement('div');
    e.className = 'explain';
    e.textContent = explanation;

    card.appendChild(v);
    card.appendChild(c);
    card.appendChild(e);

    const controls = document.createElement('div');
    controls.className = 'controls-row';

    // Store claim in a variable to ensure it's captured in closure
    const claimText = claim || '–Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω —Ñ–∞–∫—Ç';

    const readBtn = document.createElement('button');
    readBtn.className = 'btn';
    readBtn.textContent = 'üé§ –ü—Ä–æ—á–µ—Ç–∏ –†–µ–∑—É–ª—Ç–∞—Ç';
    readBtn.onclick = ()=>{
      const resultText = `–§–∞–∫—Ç—ä—Ç: ${claimText}. –†–µ–∑—É–ª—Ç–∞—Ç: ${verdict}. –£–≤–µ—Ä–µ–Ω–æ—Å—Ç ${confidence} –ø—Ä–æ—Ü–µ–Ω—Ç–∞. ${explanation}`;
      speakText(resultText, 'bg');
    };

    controls.appendChild(readBtn);
    card.appendChild(controls);
    resultsEl.appendChild(card);

    requestAnimationFrame(()=>{ card.classList.add('show'); });

  }

  async function onVerify(){
    const claim = claimEl.value.trim();
    if(!claim){ 
      claimEl.focus();
      return;
    }
    
    setLoading(true);
    resultsEl.innerHTML = `<div class="result-card show"><div class="verdict">–ü—Ä–æ–≤–µ—Ä–∫–∞‚Ä¶</div><div class="explain">–ê–Ω–∞–ª–∏–∑–∏—Ä–∞–º...</div></div>`;

    try {
      // FIX: Use absolute URL to avoid 405/404 when running from file://
      const resp = await fetch('http://127.0.0.1:8000/fact-check', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ claim: claim })
      });

      if(!resp.ok) throw new Error(`–ì—Ä–µ—à–∫–∞ –Ω–∞ —Å—ä—Ä–≤—ä—Ä–∞ ${resp.status}`);

      const data = await resp.json();
      const raw = data.result || data;

      const parsed = parseBackendResult(typeof raw === 'string' ? raw : String(raw));
      renderResult(parsed ? {...parsed, claim} : { verdict: '–†–µ–∑—É–ª—Ç–∞—Ç', confidence: 100, explanation: String(raw), claim });

    } catch(err) {
      resultsEl.innerHTML = `<div class="result-card show"><div class="verdict false">–ì—Ä–µ—à–∫–∞</div><div class="explain">–ù–µ—É—Å–ø–µ—à–Ω–æ —Å–≤—ä—Ä–∑–≤–∞–Ω–µ. –ü—Ä–æ–≤–µ—Ä–µ—Ç–µ –¥–∞–ª–∏ Uvicorn —Ä–∞–±–æ—Ç–∏ –Ω–∞ –ø–æ—Ä—Ç 8000.</div></div>`;
      console.error(err);
    } finally {
      setLoading(false);
    }
  }

  function parseBackendResult(text){
    const verdictMatch = text.match(/(?:Verdict|–í–µ—Ä–¥–∏–∫—Ç)\s*:\s*(.+)/i);
    const confidenceMatch = text.match(/(?:–£–≤–µ—Ä–µ–Ω–æ—Å—Ç|Confidence)\s*:\s*(\d{1,3})%/i);
    const explanationMatch = text.match(/(?:–û–±—è—Å–Ω–µ–Ω–∏–µ|Explanation)\s*:\s*([\s\S]+)/i);

    if(verdictMatch || confidenceMatch || explanationMatch){
      return {
        verdict: verdictMatch ? verdictMatch[1].trim() : '–ê–Ω–∞–ª–∏–∑',
        confidence: confidenceMatch ? parseInt(confidenceMatch[1],10) : 0,
        explanation: explanationMatch ? explanationMatch[1].trim() : text
      };
    }
    return null;
  }

  verifyBtn.addEventListener('click', onVerify);
  claimEl.addEventListener('keydown', (e)=>{ if(e.key === 'Enter' && (e.ctrlKey || e.metaKey)){ onVerify(); } });
})();
</script>
</body>
</html>













